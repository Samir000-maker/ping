<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ping‑Debug & Keep‑Alive</title>
  <style>
    #logArea {
      white-space: pre-wrap;
      font-family: monospace;
      background: #f5f5f5;
      padding: 10px;
      border: 1px solid #ccc;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>Server is being kept alive ✅</h2>
  <div id="logArea"></div>

  <script>
    const logArea = document.getElementById('logArea');
    const SERVER_URL = "https://samir‑hgr9.onrender.com/?ping=";

    function log(...args) {
      const timestamp = new Date().toISOString();
      const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' ');
      logArea.textContent += `[${timestamp}] ${msg}\n`;
      console.log(...args);
      // auto‑scroll
      logArea.scrollTop = logArea.scrollHeight;
    }

    async function pingWithRetry(url, retries = 3, delayMs = 1000) {
      for (let attempt = 1; attempt <= retries; attempt++) {
        try {
          log(`Attempt ${attempt} to fetch ${url}`);
          const response = await fetch(url, { method: 'GET', mode: 'cors' });
          log(`Response status: ${response.status}`);
          if (!response.ok) {
            log(`Warning: response not OK (status=${response.status}).`);
            // if last attempt, throw
            if (attempt === retries) throw new Error(`Bad status: ${response.status}`);
          } else {
            const text = await response.text();
            log(`Success! Received response: ${text}`);
            return;
          }
        } catch (err) {
          log(`Error on attempt ${attempt}:`, err);
          if (attempt === retries) {
            log(`All ${retries} attempts failed.`);
          } else {
            log(`Waiting ${delayMs}ms then retrying...`);
            await new Promise(r => setTimeout(r, delayMs));
          }
        }
      }
    }

    async function performPing() {
      const url = SERVER_URL + Date.now();
      await pingWithRetry(url, 3, 2000);
    }

    // Do the first ping immediately
    performPing();
    // Then schedule every minute
    setInterval(performPing, 1 * 60 * 1000);
  </script>
</body>
</html>
